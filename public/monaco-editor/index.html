<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <style>
        html,
        body,
        #container {
            margin: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
    </style>
    <script src="loader.js"></script>
</head>

<body>
    <div id="container"></div>

    <script>
        require.config(
            {
                paths: { vs: '.' }
            }
        );
        require(
            ['vs/editor/editor.main'],
            function ()
            {
                const editor = monaco.editor.create(
                    document.getElementById('container'),
                    {
                        value: window.code,
                        language: 'javascript',
                        theme: 'vs-dark'
                    }
                );

                editor.onDidChangeModelContent(() =>
                {
                    const code = editor.getValue();

                    window.parent?.postMessage(
                        JSON.stringify(
                            {
                                type: 'codeChange',
                                code
                            }
                        )
                    );
                });

                window.addEventListener('message', (event) =>
                {
                    try
                    {
                        const msg = JSON.parse(event.data);
                        if (msg.type === 'setCode' && msg.code)
                        {
                            editor.setValue(msg.code);
                        }
                    } catch (err)
                    {
                        console.error(err);
                    }
                });
            });
    </script>
</body>

</html>